README
============================

This website is based on the [Yii 2](http://www.yiiframework.com/) framework and the Yii 2 CMS extension [yii2-cms](https://github.com/davidhirtz/yii2-cms/).


Requirements
------------

This project requires PHP 8.1 or higher, MySQL and ImageMagick. Detailed requirements can be found by running [Composer](http://getcomposer.org/).


Installation
------------

Fetch source code via GIT.

~~~
git init
git remote add origin git@github.com:davidhirtz/adelheid.git
git fetch origin
git branch main origin/main
git checkout main
~~~

If you do not have [Composer](http://getcomposer.org/) installed, you may install it by following the instructions at [getcomposer.org](http://getcomposer.org/doc/00-intro.md#installation-nix). 
On Linux and Mac OS X, you'll run the following commands:

~~~
curl -sS https://getcomposer.org/installer | php
~~~

You can then install the dependencies using the following command:

~~~
php composer.phar install --optimize-autoloader --no-dev
~~~


Configuration
-------------

### Credentials

Run `php yii params` to create the configuration file `config/params.php` with your sensitive information, which should not be added to the version control. 
The file must include a cookie validation key, which will be auto-generated by running the command for the first time.

```php
<?php
return [
    'cookieValidationKey' => 'AUTO-GENERATED-COOKIE-VALIDATION-KEY',
    //'cookieDomain' => '.DOMAIN.COM',
    //'email' => 'YOUR-EMAIL',
    //'mailerDsn' => 'smtp://YOUR-SMTP-CONNECTION-STRING',
];
```


### Database

Apply the database migrations by running the command `php yii migrate`. This will also set up the database configuration before applying the migrations. 
The database credentials are saved to `config/db.php`. Migrations will automatically be checked when running `composer install`.

```php
<?php
return [
    'dsn' => 'mysql:host=127.0.0.1;dbname=DATABASE',
    'username' => 'USER',
    'password' => 'PASSWORD',
];
```


### Permissions

Directories `runtime`, `web/assets` and `web/uploads` need write permissions for web and console user. These permissions are automatically set when running `composer install`.


### Development

You can enable development mode by setting an environment variable `YII_ENV` to "dev" or "local". The latter is excluded from version control.

CSS and Javascript assets are processed with [esbuild](https://esbuild.github.io/) and need to be recompiled after a change. 
Make sure you have [Node.js](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) installed, run `npm install` to install the development dependencies, 
then run `npm run build`.


Structure
-------------------

      app/                the PSR-4 application root, containing custom application models, components, controllers, views and widgets
      config/             application and database configurations
      node_modules/       3rd-party NPM libraries (development only)
      resources/          uncompiled CSS and Javascript files and the view templates
      runtime/            cache and log files generated during runtime
      tests/              various tests for the application
      vendor/             dependent 3rd-party packages
      web/                the webroot, containing the entry script, published resources and uploads
